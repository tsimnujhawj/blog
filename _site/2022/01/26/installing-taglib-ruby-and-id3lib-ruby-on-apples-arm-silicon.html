<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Installing taglib-ruby and id3lib-ruby on Apple's ARM Silicon</title><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Tsimnuj Hawj" /><link rel="shortcut icon" type="image/x-icon" href="" />
  <link rel="stylesheet" href="/assets/css/main.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.css" integrity="sha384-OH8qNTHoMMVNVcKdKewlipV4SErXqccxxlg6HC9Cwjr5oZu2AdBej1TndeCirael" crossorigin="anonymous">

</head>
<body a="light">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/"><..</a><article>
  <p class="post-meta">
    <time datetime="2022-01-26 19:03:23 -0600">2022-01-26</time>
  </p>
  
  <h1>Installing taglib-ruby and id3lib-ruby on Apple's ARM Silicon</h1>

  <p><a href="#now-the-solution">Take me to the solution.</a></p>

<p>As you may or may not know, Apple is transitioning away from Intel chips on their Macs to their own <a href="https://en.wikipedia.org/wiki/Apple_silicon" target="_blank">Apple’s Silicon</a> ARM-based chip. Most general users won’t care too much about the transition, but for developers who use their Macbook Pros as a main driver, this gives some reason for pause.</p>

<p>I received a new Macbook Pro with the M1 Pro chip from work. Which was much needed, as I was working on an older i5 8GB 256GB loaner until the shop was able to give me a new machine.</p>

<p>I was excited to be able to run my rake tasks without having to watch the wheel spin. I was, however, unprepared for the headache of watching my builds fail. The new territory of developing on the ARM and the combination of our application using outdated gems was a new challenge. One particular challenge was trying to build the <a href="https://github.com/robinst/id3lib-ruby" target="_blank">id3lib-ruby</a> and <a href="https://github.com/robinst/taglib-ruby" target="_blank">taglib-ruby</a> gems.</p>

<p><a href="https://en.wikipedia.org/wiki/Information_foraging" target="_blank">Information foraging</a><sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> failed me. This challenge was unique and relatively new. Not a whole lot of logs exist on this. So, this had me stumped. And for a good reason: <strong>I learned that I still had a lot to learn about being a better programmer.</strong> I depended too much on information foraging and I’ve finally met a challenge that someone else hadn’t solved.</p>

<p>I learned an important lesson: I spent too much of my time foraging the internet for a solution, when I could have been a better programmer. I could have earlier cloned the failing gems/libraries/modules and dug through the code to find the faulty line. I learned that I didn’t have the confidence to trust myself as a professional. I didn’t think I was smart enough to evaluate someone else’s code.</p>

<p>After hours of foraging, I eventually realized that I had to solve this build failure on my own. Big revelation, I know…</p>

<p>I eventually cloned the id3lib-ruby and taglib-ruby gems onto my local machine. I dug through the code base and used the error logs to figure out where the failure was occuring. That wasn’t so hard…</p>

<h2 id="the-error-messages">The Error Messages:</h2>

<p><strong>id3lib-ruby error message:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Building native extensions. This could take a <span class="k">while</span>...
ERROR:  Error installing id3lib-ruby:
        ERROR: Failed to build gem native extension.
 
    current directory: /Users/USERNAME/.gem/gems/id3lib-ruby-0.6.0/ext/id3lib_api
/Users/USERNAME/.rbenv/versions/2.6.5/bin/ruby <span class="nt">-I</span> /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0 <span class="nt">-r</span> ./siteconf20220126-61097-15xkr2v.rb extconf.rb
checking <span class="k">for</span> <span class="nt">-lstdc</span>++... <span class="nb">yes
</span>checking <span class="k">for</span> <span class="nt">-lz</span>... <span class="nb">yes
</span>checking <span class="k">for</span> <span class="nt">-liconv</span>... <span class="nb">yes
</span>checking <span class="k">for </span>id3.h... no
You must have id3lib installed <span class="k">in </span>order to use id3lib-ruby.
<span class="k">***</span> extconf.rb failed <span class="k">***</span>
Could not create Makefile due to some reason, probably lack of necessary
libraries and/or headers.  Check the mkmf.log file <span class="k">for </span>more details.  You may
need configuration options.
 
Provided configuration options:
        <span class="nt">--with-opt-dir</span>
        <span class="nt">--with-opt-include</span>
        <span class="nt">--without-opt-include</span><span class="o">=</span><span class="k">${</span><span class="nv">opt</span><span class="p">-dir</span><span class="k">}</span>/include
        <span class="nt">--with-opt-lib</span>
        <span class="nt">--without-opt-lib</span><span class="o">=</span><span class="k">${</span><span class="nv">opt</span><span class="p">-dir</span><span class="k">}</span>/lib
        <span class="nt">--with-make-prog</span>
        <span class="nt">--without-make-prog</span>
        <span class="nt">--srcdir</span><span class="o">=</span><span class="nb">.</span>
        <span class="nt">--curdir</span>
        <span class="nt">--ruby</span><span class="o">=</span>/Users/USERNAME/.rbenv/versions/2.6.5/bin/<span class="si">$(</span>RUBY_BASE_NAME<span class="si">)</span>
        <span class="nt">--with-stdc</span>++lib
        <span class="nt">--without-stdc</span>++lib
        <span class="nt">--with-zlib</span>
        <span class="nt">--without-zlib</span>
        <span class="nt">--with-iconvlib</span>
        <span class="nt">--without-iconvlib</span>
 
To see why this extension failed to compile, please check the mkmf.log which can be found here:
 
  /Users/USERNAME/.gem/extensions/-darwin-21/2.6.0/id3lib-ruby-0.6.0/mkmf.log
 
extconf failed, <span class="nb">exit </span>code 1
 
Gem files will remain installed <span class="k">in</span> /Users/USERNAME/.gem/gems/id3lib-ruby-0.6.0 <span class="k">for </span>inspection.
Results logged to /Users/USERNAME/.gem/extensions/-darwin-21/2.6.0/id3lib-ruby-0.6.0/gem_make.out
</code></pre></div></div>

<p><strong>taglib-ruby error message:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Gem::Ext::BuildError: ERROR: Failed to build gem native extension.
 
    current directory: /Users/USERNAME/.gem/gems/taglib-ruby-1.1.0/ext/taglib_base
/Users/USERNAME/.rbenv/versions/2.6.5/bin/ruby <span class="nt">-I</span> /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0 <span class="nt">-r</span> ./siteconf20220126-46818-1p3xheg.rb extconf.rb
checking <span class="k">for</span> <span class="nt">-lstdc</span>++... <span class="nb">yes
</span>checking <span class="k">for</span> <span class="nt">-ltag</span>... <span class="nb">yes
</span>creating Makefile
 
current directory: /Users/USERNAME/.gem/gems/taglib-ruby-1.1.0/ext/taglib_base
make <span class="s2">"DESTDIR="</span> clean
 
current directory: /Users/USERNAME/.gem/gems/taglib-ruby-1.1.0/ext/taglib_base
make <span class="s2">"DESTDIR="</span>
compiling taglib_base_wrap.cxx
taglib_base_wrap.cxx:1179:1: warning: <span class="k">function</span> <span class="s1">'Ruby_Format_OverloadedError'</span> could be declared with attribute <span class="s1">'noreturn'</span> <span class="o">[</span><span class="nt">-Wmissing-noreturn</span><span class="o">]</span>
<span class="o">{</span>
^
taglib_base_wrap.cxx:1871:10: fatal error: <span class="s1">'taglib/taglib.h'</span> file not found
<span class="c">#include &lt;taglib/taglib.h&gt;</span>
         ^~~~~~~~~~~~~~~~~
1 warning and 1 error generated.
make: <span class="k">***</span> <span class="o">[</span>taglib_base_wrap.o] Error 1
 
make failed, <span class="nb">exit </span>code 2
 
Gem files will remain installed <span class="k">in</span> /Users/USERNAME/.gem/gems/taglib-ruby-1.1.0 <span class="k">for </span>inspection.
Results logged to /Users/USERNAME/.gem/extensions/-darwin-21/2.6.0/taglib-ruby-1.1.0/gem_make.out
 
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:99:in <span class="sb">`</span>run<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:51:in `block in make'</span>
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:43:in <span class="sb">`</span>each<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:43:in `make'</span>
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/ext_conf_builder.rb:62:in <span class="sb">`</span>block <span class="k">in </span>build<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/tempfile.rb:295:in `open'</span>
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/ext_conf_builder.rb:29:in <span class="sb">`</span>build<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:185:in `block in build_extension'</span>
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/monitor.rb:235:in <span class="sb">`</span>mon_synchronize<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:181:in `build_extension'</span>
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:229:in <span class="sb">`</span>block <span class="k">in </span>build_extensions<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:226:in `each'</span>
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/ext/builder.rb:226:in <span class="sb">`</span>build_extensions<span class="s1">'
  /Users/USERNAME/.rbenv/versions/2.6.5/lib/ruby/2.6.0/rubygems/installer.rb:830:in `build_extensions'</span>
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/rubygems_gem_installer.rb:71:in <span class="sb">`</span>build_extensions<span class="s1">'
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/rubygems_gem_installer.rb:28:in `install'</span>
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/source/rubygems.rb:204:in <span class="sb">`</span><span class="nb">install</span><span class="s1">'
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/installer/gem_installer.rb:54:in `install'</span>
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/installer/gem_installer.rb:16:in <span class="sb">`</span>install_from_spec<span class="s1">'
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/installer/parallel_installer.rb:186:in `do_install'</span>
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/installer/parallel_installer.rb:177:in <span class="sb">`</span>block <span class="k">in </span>worker_pool<span class="s1">'
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/worker.rb:62:in `apply_func'</span>
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/worker.rb:57:in <span class="sb">`</span>block <span class="k">in </span>process_queue<span class="s1">'
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/worker.rb:54:in `loop'</span>
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/worker.rb:54:in <span class="sb">`</span>process_queue<span class="s1">'
  /Users/USERNAME/.gem/gems/bundler-2.3.6/lib/bundler/worker.rb:91:in `block (2 levels) in create_threads'</span>
 
An error occurred <span class="k">while </span>installing taglib-ruby <span class="o">(</span>1.1.0<span class="o">)</span>, and Bundler cannot <span class="k">continue</span><span class="nb">.</span>
 
In Gemfile:
  taglib-ruby
</code></pre></div></div>

<h1 id="now-the-solution">Now, the solution:</h1>

<p>The <a href="https://github.com/robinst/id3lib-ruby" target="_blank">id3lib-ruby</a> and <a href="https://github.com/robinst/taglib-ruby" target="_blank">taglib-ruby</a> gems are attempting to find the <a href="https://taglib.org/" target="_blank">taglib</a> and <a href="http://id3lib.sourceforge.net/" target="_blank">id3lib</a> packages in a location native to the x86 architecture. <a href="https://brew.sh" target="_blank">Homebrew</a> and its packages are installed in a different location: <code class="language-plaintext highlighter-rouge">/opt/homebrew</code> and <code class="language-plaintext highlighter-rouge">/opt/homebrew/Cellar</code></p>

<p class="message">
  You may need to uninstall Homebrew and reinstall it via:
  <a href="https://github.com/mikelxc/Workarounds-for-ARM-mac" target="_blank">Homebrew ARM install</a>
</p>

<p><strong><em>We just need to export the new locations as environment variables for our gems to use.</em></strong></p>

<p>You’ll need to export two variables:</p>

<p>id3lib-ruby:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CONFIGURE_ARGS</span><span class="o">=</span><span class="s2">"--with-opt-dir=</span><span class="si">$(</span>brew <span class="nt">--prefix</span> id3lib<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>
<p>taglib-ruby:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TAGLIB_DIR</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>brew <span class="nt">--prefix</span> taglib<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>
<p>Of course, make sure to check your id3lib and taglib locations by using:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew info taglib
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew info id3lib
</code></pre></div></div>

<p>After you’ve exported your <code class="language-plaintext highlighter-rouge">CONFIGURE_ARGS</code> and <code class="language-plaintext highlighter-rouge">TAGLIB_DIR</code>, you can run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">install</span>
</code></pre></div></div>

<p>I hope this has helped you! Thanks for reading.</p>

<hr />
<h2 id="footnotes">Footnotes</h2>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1">
      <p>I learned this term from my fiancée, who is doing her Master’s in Educational Psychology at the University of Minnesota. This is a skill that a lot of programmers depend on. Scouring forums, blogs, Stack Overflow, GitHub Issues, etc. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

</article>
      </div>
    </main>
  </body>
</html>